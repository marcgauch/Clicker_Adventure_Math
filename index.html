<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Ultra HÃ¼hnergame</title>

  <!-- Add Vue to the Project -->
  <script src="https://unpkg.com/vue"></script>

  <!-- Add Bootstrap and Bootstrap-Vue CSS to the <head> section -->
  <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
  <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css" />

  <!-- Add Vue and Bootstrap-Vue JS just before the closing </body> tag -->
  <script src="https://unpkg.com/vue/dist/vue.min.js"></script>
  <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>

  <!-- Polyfill for old and stupid browsers *cough* IE *cough* -->
  <script src="https://unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>

</head>

<body>
  <div id="app">
    <b-card-group deck>
      <b-card style="max-width: 15em;" header="Money">
        {{ money }} CHF
      </b-card>
    </b-card-group>
    <b-card-group deck>
      <b-card style="max-width: 15rem;">
        <template v-slot:header>
          Addition
          <span class="float-right">[+{{ operations.addition.worth }} CHF]</span>
        </template>
        <b-layout fluid>
          <b-row>
            <b-col>
              {{ operations.addition.a }} + {{ operations.addition.b }} = 
            </b-col>
            <b-col cols="7">
              <b-input v-model="operations.addition.entered" @keyup="enteredAResult('addition')"></b-input>
            </b-col>
          </b-row>
        </b-layout>
      </b-card>

      <b-card style="max-width: 15rem;" v-if="operations.subtraction.allow">
        <template v-slot:header>
          Subtraction
          <span class="float-right">[+{{ operations.subtraction.worth }} CHF]</span>
        </template>
        <b-layout fluid>
          <b-row>
            <b-col>
              {{ operations.subtraction.a }} - {{ operations.subtraction.b }} = 
            </b-col>
            <b-col cols="7">
              <b-input v-model="operations.subtraction.entered" @keyup="enteredAResult('subtraction')"></b-input>
            </b-col>
          </b-row>
        </b-layout>
      </b-card>
    </b-card-group>
    <b-card-group deck>
      <b-card header="Shop" style="max-width: 15rem;" h>
        <b-layout fluid>
          <b-row v-if="!operations.subtraction.allow">
            <b-col>
              subraction
            </b-col>
            <b-col>
              <b-button variant="primary" :disabled="money < operations.subtraction.unlockPrice" @click="buy('subtraction')">{{ operations.subtraction.unlockPrice }} CHF</b-button>
            </b-col>
          </b-row>
        </b-layout>
      </b-card>

    </b-card-group>
    <b-card header="debug">
      <pre>
{{ $data }}
      </pre>
    </b-card>
  </div>

  <script>
    var app = new Vue({
      el: '#app',
      data: {
        money: 47n,
        operations: {
          addition: {
            worth: 1,
            a: 0,
            b: 0,
            result: '0',
            entered: ''
          },
          subtraction: {
            allow: false,
            unlockPrice: 50n,
            worth: 2,
            a: 0,
            b: 0,
            result: '0',
            entered: ''
          }
        }
      },
      created: function () {
        BigInt.prototype.toJSON = function () { return this.toString() }
        setInterval(() => {
          this.update()
        }, 10)
      },
      methods: {
        update: function () {
         
        },
        getRandomNumber() {
          return Math.floor(Math.random() * 10)
        },
        enteredAResult: function (which) {
          switch (which) {
            case "addition":
              if (this.operations.addition.entered === this.operations.addition.result){
                this.operations.addition.entered = ''
                this.money += BigInt(this.operations.addition.worth)
                const A = this.getRandomNumber()
                const B = this.getRandomNumber()
                this.operations.addition.a = A
                this.operations.addition.b = B
                this.operations.addition.result = `${A+B}`
              }
              break
            case "subtraction":
              if (this.operations.subtraction.entered === this.operations.subtraction.result){
                this.operations.subtraction.entered = ''
                this.money += BigInt(this.operations.subtraction.worth)
                const A = this.getRandomNumber()
                const B = this.getRandomNumber()
                if (A >= B){
                  this.operations.subtraction.a = A
                  this.operations.subtraction.b = B
                  this.operations.subtraction.result = `${A-B}`
                } else {
                  this.operations.subtraction.a = B
                  this.operations.subtraction.b = A
                  this.operations.subtraction.result = `${B-A}`
                }
              }
              break
          }
        },
        buy(what) {
          switch (what) {
            case "subtraction":
              this.money -= this.operations.subtraction.unlockPrice
              this.operations.subtraction.allow = true
            break
          }
        }
      }
    })
  </script>
</body>

</html>